var Beep={VERSION:7,verbosity:.5,AudioContext:window.AudioContext?window.AudioContext:window.webkitAudioContext,voices:[],samples:[],triggers:[],instruments:[],domContainer:null,isKeyboarding:!0,setupTasks:[function(){void 0===Beep.audioContext&&(Beep.audioContext=new Beep.AudioContext)},function(){null===Beep.domContainer&&(Beep.domContainer=document.getElementById("beep"))},function(){0<Beep.verbosity&&console.log("Beep",Beep.VERSION)}],setup:function(){for(var a;a=this.setupTasks.shift();)"function"===
typeof a&&a()},teardown:function(){for(;this.instruments.length;)this.instruments.pop().teardown();for(;this.triggers.length;)this.triggers.pop().teardown();for(;this.samples.length;)this.samples.pop().teardown();for(;this.voices.length;)this.voices.pop().teardown()},reset:function(){this.teardown();this.setup()},parseMultilineString:function(a){a=a.toString();var b=a.indexOf("/*")+2,c=a.indexOf("*/",b);return a.substring(b,c).replace(/\/\+/g,"/*").replace(/\+\//g,"*/")}};
document.addEventListener("DOMContentLoaded",function(){Beep.setup()});Beep.Note=function(a){var b=this;if("number"===typeof a)this.hertz=a;else if("object"===typeof a&&void 0!==a.hertz)Object.keys(a).forEach(function(c){b[c]=a[c]});else return Beep.Note.EDO12(a)};
Beep.Note.validateWestern=function(a){function b(a){0>a.letterIndex&&(a.letterIndex+=7,a.octaveIndex--);7<=a.letterIndex&&(a.letterIndex-=7);a.letter="ABCDEFG".substr(a.letterIndex,1);return a}var c;"undefined"===typeof a?a={}:"string"===typeof a&&(c=a,a={},c.split("").forEach(function(b,c){"NaN"!==+b+""?a.octaveIndex=+b:-1!=="♭♮♯#".indexOf(b)?a.modifier=b:-1!=="ABCDEFGH".indexOf(b.toUpperCase())&&("H"===b.toUpperCase()?a.letter="B":"b"===b&&0<c?a.modifier="♭":a.letter=b.toUpperCase())}));if(void 0===
a.octaveIndex||""===a.octaveIndex||"NaN"===+a.octaveIndex+"")a.octaveIndex=4;a.octaveIndex=+a.octaveIndex;0>a.octaveIndex?a.octaveIndex=0:8<a.octaveIndex&&(a.octaveIndex=8);void 0===a.letter&&(a.letter="A");a.letterIndex="ABCDEFG".indexOf(a.letter);void 0===a.modifier&&(a.modifier="♮");void 0===a.A&&(a.A=440);"b"===a.modifier&&(a.modifier="♭");"#"===a.modifier&&(a.modifier="♯");"♭"===a.modifier&&-1==="EAB".indexOf(a.letter)?(a.letterIndex="ABCDEFG".indexOf(a.letter)-1,a=b(a),-1<"CF".indexOf(a.letter)?
a.modifier="♯":a.modifier="♮"):"♯"===a.modifier&&-1==="CF".indexOf(a.letter)&&(a.letterIndex="ABCDEFG".indexOf(a.letter)+1,a=b(a),-1<"EAB".indexOf(a.letter)?a.modifier="♭":a.modifier="♮");"♯"===a.modifier?a.isSharp=!0:"♭"===a.modifier?a.isFlat=!0:a.isNatural=!0;a=b(a);a.name=a.letter+a.modifier;a.nameSimple=a.letter;"♮"!==a.modifier&&(a.nameSimple+=a.modifier);a.nameIndex="A♭ A♮ B♭ B♮ C♮ C♯ D♮ E♭ E♮ F♮ F♯ G♮".split(" ").indexOf(a.name);8===a.octaveIndex&&"C"!==a.nameSimple&&(a.octaveIndex=7);a.pianoKeyIndex=
12*a.octaveIndex+a.nameIndex;3<a.nameIndex&&(a.pianoKeyIndex-=12);a.midiNumber=a.pianoKeyIndex+20;void 0===a.tuning&&(a.tuning="EDO12");return a};Beep.Note.EDO12=function(a){a=Beep.Note.validateWestern(a);a.hertz=a.A*Math.pow(Math.pow(2,1/12),a.pianoKeyIndex-49);a.tuning="EDO12";return new Beep.Note(a)};
Beep.Note.JustIntonation=function(a,b){var c;a=Beep.Note.validateWestern(a);a.tuning="JustIntonation";a.key=new Beep.Note.EDO12(b);c=(a.nameIndex-a.key.nameIndex)%12;0>c&&(c+=12);a.hertz=[a.key.hertz,16*a.key.hertz/15,9*a.key.hertz/8,6*a.key.hertz/5,5*a.key.hertz/4,4*a.key.hertz/3,45*a.key.hertz/32,3*a.key.hertz/2,8*a.key.hertz/5,5*a.key.hertz/3,16*a.key.hertz/9,15*a.key.hertz/8,2*a.key.hertz][c];a.hertz*=Math.pow(2,a.octaveIndex-a.key.octaveIndex);return new Beep.Note(a)};
Beep.Note.seemsLegit=function(a){var b=!0,c=0,e=0,g=0,h=0,d,f;if(a instanceof Beep.Note||"number"===typeof a)return!0;if("string"===typeof a){if(3<a.length)return!1;for(f=0;f<a.length;f++)if(d=a[f],"NaN"!==+d+""&&0<=+d&&8>=+d)e++;else if(0<="ABCDEFGHacdefgh".indexOf(d))c++;else if(0<="♮♯♭#".indexOf(d))g++;else if("b"===d)h++;else{b=!1;break}if(1<e||1<c||1<g||1<h||2<c+g+h)b=!1;return b}return!1};Beep.Sample=function(){var a,b;for(b=0;b<arguments.length&&3>=b;b++)a=arguments[b],"string"===typeof a?Beep.Sample.seemsLikeAudioFileName(a)?this.domElement=new Audio(a):this.domElement=document.getElementById(a):a instanceof Beep.AudioContext?(this.audioContext=a,this.destination=a.destination):a instanceof GainNode&&(this.audioContext=a.audioContext,this.destination=a);!1===this.domElement instanceof HTMLAudioElement&&(this.domElement=new Audio);void 0===this.audioContext&&(this.audioContext=new Beep.AudioContext,
this.destination=this.audioContext.destination);this.domElement.crossOrigin="anonymous";this.domElement.preload="auto";this.domElement.loop="loop";void 0===this.domElement.src&&(this.domElement.src="https://storage.googleapis.com/chhirp-prod-aac-hdortfjlzncw/50e7eb29-a951-4757-942c-981b4c521d36.mp4");this.source=Beep.audioContext.createMediaElementSource(this.domElement);this.source.mediaElement.crossOrigin="anonymous";this.source.connect(this.destination);this.isTorndown=!1;Beep.samples.push(this)};
Beep.Sample.seemsLikeAudioFileName=function(a){return"string"===typeof a&&0<=a.search(/\.(aac|mp3|mp4|ogg|webm|wav)(\?.*|)$/)};Beep.Sample.prototype.teardown=function(){!1===this.isTorndown&&(this.source.disconnect(),this.isTorndown=!0);return this};Beep.Voice=function(a,b){a instanceof Beep.AudioContext||a instanceof GainNode?(a instanceof Beep.AudioContext?(this.audioContext=a,this.destination=a.destination):a instanceof GainNode&&(this.audioContext=a.audioContext,this.destination=a),this.note=b instanceof Beep.Note?b:new Beep.Note(b)):(this.note=a instanceof Beep.Note?a:new Beep.Note(a),b instanceof Beep.AudioContext?(this.audioContext=b,this.destination=b.destination):b instanceof GainNode?(this.audioContext=b.audioContext,this.destination=
b):(this.audioContext=Beep.audioContext,this.destination=this.audioContext.destination));this.setup();Beep.voices.push(this)};
Beep.Voice.prototype.setup=function(){this.gainNode=this.audioContext.createGain();this.gainNode.gain.value=0;this.gainNode.connect(this.destination);this.delayDuration=0;this.attackGain=.15;this.decayDuration=this.attackDuration=.05;this.sustainGain=.8;this.sustainDuration=Infinity;this.releaseDuration=.1;this.isPlaying=!1;this.noteEnabled=!0;this.oscillator=this.audioContext.createOscillator();this.oscillator.connect(this.gainNode);this.oscillator.type="sine";this.oscillator.frequency.value=this.note.hertz;
this.isTorndown=this.sampleEnabled=!1};
Beep.Voice.prototype.play=function(a){var b=this,c=this.audioContext.currentTime,e=this.gainNode.gain.value;"number"!==typeof a&&(a=.5);this.noteEnabled&&(this.oscillator.frequency.value=this.note.hertz);this.sampleEnabled&&(this.sampleResetOnPlay&&(this.sample.currentTime=0),this.sample.play());this.gainNode.gain.cancelScheduledValues(c);this.gainNode.gain.setValueAtTime(e,c);this.delayDuration&&this.gainNode.gain.setValueAtTime(e,c+this.delayDuration);this.gainNode.gain.linearRampToValueAtTime(a*this.attackGain,
c+this.delayDuration+this.attackDuration);this.gainNode.gain.linearRampToValueAtTime(a*this.attackGain*this.sustainGain,c+this.delayDuration+this.attackDuration+this.decayDuration);!1===this.isPlaying&&(this.isPlaying=!0,this.noteEnabled&&this.oscillator.start(0));Infinity!==this.sustainDuration&&setTimeout(function(){b.pause()},c+this.delayDuration+this.attackDuration+1E3*this.sustainDuration);return this};
Beep.Voice.prototype.pause=function(){var a=this.audioContext.currentTime;this.gainNode.gain.cancelScheduledValues(a);this.gainNode.gain.setValueAtTime(this.gainNode.gain.value,a);this.gainNode.gain.linearRampToValueAtTime(1E-4,a+this.releaseDuration);this.gainNode.gain.setValueAtTime(0,a+this.releaseDuration+1E-4);return this};
Beep.Voice.prototype.teardown=function(){!1===this.isTorndown&&(this.oscillator&&(this.isPlaying&&this.oscillator.stop(0),this.oscillator.disconnect()),this.source&&this.source.disconnect(),this.isTorndown=!0);return this};
"delayDuration attackGain attackDuration decayDuration sustainGain sustainDuration releaseDuration".split(" ").forEach(function(a){var b=a.substr(0,1).toUpperCase()+a.substr(1);Beep.Voice.prototype["get"+b]=function(){return this[a]};Beep.Voice.prototype["set"+b]=function(b){this[a]=b;return this}});Beep.Voice.prototype.getOscillatorType=function(){return this.oscillator?this.oscillator.type:void 0};Beep.Voice.prototype.setOscillatorType=function(a){this.oscillator&&(this.oscillator.type=a);return this};
